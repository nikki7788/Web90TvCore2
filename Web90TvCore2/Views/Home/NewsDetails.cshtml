@model IndexViewModel

@{
    ViewData["Title"] = "جزییات خبر";
}


<div id="container" class="container-fluid">
    <!--start header-->
    @await Html.PartialAsync("~/Views/Shared/PartialViews/_HeaderPartial.cshtml")
    <!--start  navbar-->
    @await Html.PartialAsync("~/Views/Shared/PartialViews/_NavbarPartial.cshtml")
    <!--End navbar-->
    <!--start content-->
    <div class=" mt-3" id="content">
        <!--start content-body-->
        <div class="row" id="content-body">
            <!--start main content-->
            <div class="col-xl-8 col-lg-8 col-md-8 col-sm-12">

                <div id="newsDetails">
                    <!--Start NewsDetails-->
                    @await Html.PartialAsync("~/Views/Shared/PartialViews/_NewsdetailPartial.cshtml", Model.NewsDetails)
                    <!--End NewsDetails-->
                </div>

            </div>   <!--end main content-->
            <!--start list second part-->
            <div class="col-xl-4 col-lg-4 col-md-4 col-sm-12">
                <!--start last-info-->
                <!--چون این پارشال ویو از چندین مدل تغذیه میکند مدلی در اینجا به ان معرفی نمیکنیم و در پارشال مدل داینامیک میکیریم-->
                @await Html.PartialAsync("~/Views/Shared/PartialViews/_LastInfoPartial.cshtml")
                <!--end lst-info-->
                <!--start newspapers-->
                @await Html.PartialAsync("~/Views/Shared/PartialViews/_NewspapersPartial.cshtml")
                <!--end newspapers-->



            </div><!--end list second part-->
        </div><!--end content-body-->
    </div> <!--end content-->
    <!--start footer-->
    @await Html.PartialAsync("~/Views/Shared/PartialViews/_FooterPartial.cshtml")
    <!--End footer-->
</div><!--end container-->

@section scripts{
    <script>
        $('#myTabs a').click(function (e) {
            e.preventDefault()
            $(this).tab('show')
        });
    </script>
    <script type="text/javascript">
        $(document).ready(function () {

        //نظرات
        //پارشال ویو هارا باید در ویویی که در ان قرار دارند بنویسیم نه خود پارشال  jquery دستورات
        $("#FrmCm").submit(function (e) {

            //از انجام دستورات و دریافت اطلاعات پیش قرض از دیتابیس خودداری میکند
            e.preventDefault();
            //دریافت تمام اطلاعات اینپوت های فرم
            // formdata روش دوم استفاده
            var form = $(this);

            $.ajax({
                type: "post",
                url: '@Url.Action("InsertComment", "Home")',

                //اطلاعات کش مرورگر را همراه فرم نفرستد
                cache: false,

                // اطلاعات سریالایز کردیم برای امنیت
                data: form.serialize(),


                beforeSend: function () {

                    $(".se-pre-con").fadeIn('fast');
                },

                success: function (msg) {
                    if (msg.status === "failValidation") {

                        $("#successBox").removeClass("d-none").addClass("alert-danger").text("لطفا اطلاعات خواسته شده را کامل کنید");
                    };
                    if (msg.status === "success") {
                        $("#successBox").removeClass("d-none").removeClass("alert-danger").addClass("alter-success").html("نظر شما با موفقیت ثبت شد و پس از تایید نمایش داده می شود");
                        $("#txtEmail").val("");
                        $("#txtFullname").val("");
                        $("#txtComment").val("");
                    };
                    if (msg.status === "failSystem") {
                         //برای حالت هایی که نطر ارسال میشود با موفقیت ولی خطایی وجود دارد مثلا آیدی خبر وجود نداشته باشد
                        $('#successBox').removeClass('d-none').addClass('alert-danger').text('سیستم موقتا قطع می باشد. لطفا بعدا سعی نمایید');

                        //محو کردن لودینگ   fading out loading
                        $(".se-pre-con").fadeOut('slow');

                    };
                }

            }).done(function () {
                //وقتی عملیات تمام شد
                //محو کردن لودینگ   fading out loading
                $(".se-pre-con").fadeOut('slow');

                }).fail(function (msg) {
                    if (msg.status === "failSystem") {
                        $('#successBox').removeClass('d-none').addClass('alert-danger').text('سیستم موقتا قطع می باشد. لطفا بعدا سعی نمایید');

                        //محو کردن لودینگ   fading out loading
                        $(".se-pre-con").fadeOut('slow');

                    };

                });

        });
        });
//todo:buttom loading مانده
    </script>
}
