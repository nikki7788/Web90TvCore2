@model IndexViewModel

@{
    ViewData["Title"] = "صفحه اصلی";
}
@* sweetalert *@
<link href="~/node_modules/sweetalert2/dist/sweetalert2.css" rel="stylesheet" />
<!-- General container-->
<div id="container" class="container-fluid">
    <!--start header-->
    @await Html.PartialAsync("PartialViews/_HeaderPartial", Model.Advertises.Where(a => a.AdvLocation == 1))

    <!--start  navbar-->
    @await Html.PartialAsync("PartialViews/_NavbarPartial")
    <!--End navbar-->
    <!--start content-->
    <div class=" mt-3" id="content">
        <!--start content-body-->
        <div class="row" id="content-body">
            <!--start main content-->
            <div class="col-xl-6 col-lg-6 col-md-6 col-sm-12">

                <!--start slider or carousel-->
                @await Html.PartialAsync("PartialViews/_SliderPartial", Model.SliderNews)
                <!--end slider or carousel-->
                <!--start the  advers below slider-->
                @foreach (var item in Model.Advertises.Where(a => a.AdvLocation == 2))
                {
                    <div class="advers-main-content">
                        <img src="~/upload/advImage/@item.GifPath" />
                    </div>
                }
                <!--end main advers-->
                <!-- start special news-->
                @await Html.PartialAsync("PartialViews/_SpecialNewsPartial", Model.SpecialNews)
                <!--end special news-->

                @foreach (var item in Model.Advertises.Where(a => a.AdvLocation == 3))
                {
                    <!--start main advers-->
                    <div class="advers-main-content">
                        <img src="~/upload/advImage/@item.GifPath" />
                    </div>
                }


                <!--end main advers-->
                <!--start last-videos-->
                @await Html.PartialAsync("PartialViews/_LastVideosPartial", Model.LastVideos)
                <!--End last videos-->
                <!--start the  advers below slider-->
                @foreach (var item in Model.Advertises.Where(a => a.AdvLocation == 4))
                {
                    <div class="advers-main-content">
                        <img src="image/adv-bootum-mainslider.gif" />
                    </div>
                }


            </div>   <!--end main content-->
            <!--start list second part-->
            <div class="col-xl-4 col-lg-4 col-md-4 col-sm-12">
                <!--start last-info-->
                <!--چون این پارشال ویو از چندین مدل تغذیه میکند مدلی در اینجا به ان معرفی نمیکنیم و در پارشال مدل داینامیک میکیریم-->
                @await Html.PartialAsync("PartialViews/_LastInfoPartial")
                <!--end lst-info-->
                <!--start newspapers-->
                @await Html.PartialAsync("PartialViews/_NewspapersPartial")
                <!--end newspapers-->
                <!--start poll-->
                @if (Model.Poll != null)
                {
                    @await Html.PartialAsync("PartialViews/_PollPartial", Model.Poll)

                }
                <!--end poll-->
                <!--start Login-->
                @await Html.PartialAsync("PartialViews/_LoginPartial", Model.LoginVM)
                <!--end Login-->


            </div><!--end list second part-->
            <!--start advers-->
            @await Html.PartialAsync("PartialViews/_AdvertisingPartial", Model.Advertises.Where(a => a.AdvLocation == 5))
            <!--end advers-->
        </div><!--end content-body-->
    </div> <!--end content-->
    <!--start footer-->
    @await Html.PartialAsync("PartialViews/_FooterPartial")
    <!--End footer-->
</div><!--end container-->
<!-- دریافت ویو مدل نمایش نتایج نظر سنجی  -->
<div class="d-none" id="getListOfAnswer">@ViewBag.getListofAnswer</div>


@section scripts{
    @* sweetaalert *@
    <script src="~/node_modules/sweetalert2/dist/sweetalert2.js"></script>

   
    @* ارسال فرم لاگین *@
    <script>
        //$(document).ready(function () {

        $("#frmLogin").submit(function (e) {
            e.preventDefault();  //از عمیلیات پیش فرض سابمیت فرم جلوگیری میکند
            var form = $(this);    //تمام مقادیر اینپوت های فرم را میاورد و داخل متغیر میریزد.درپاقع اطلاعات فرم را میخواند

            //   میشود  action تگ هلپرهای ادرس دهی هم در اخر تبدیل به اتریبیوت
            //     asp-area  asp-action   asp-controller  ====> action="/..../.../"
            var url = $("#frmLogin").attr("action"); //آدرسی(کنترلر و اکشن و اریا) که فرم باید به ان ارسال شود را میخواند از روی اتریبیپت های فرم

            $.ajax({

                type: "Post",

                url: url, //     به این روش هم میتوان دستی داد ادرس را '@@Url.Action("action","controller", new { area = ""})'

                data: form.serialize(),

                //اکر ایجکس موفقیت امیز بود ئ ارسال موفق بود
                success: function (msg) {

                    if (msg.status === "success") {

                        window.location.href = '/Adminpanel/User';
                        //window.location.href ='@@Url.Action( "Index", "User")';
                    }
                    else if (msg.status === "failInput") {

                        $("#validationLogin").text("نام کاربری یا رمز عبور اشتباه است");
                    }
                    else if (msg.status === "failEmptyInput") {

                        $("#validationLogin").text("نام کاربری یا رمز عبور وارد نشده است ");
                    }
                }

            });



        });


        //});

    </script>

    @* ثبت رای نطر سنجی *@
    <script>
        $('#btnpolling').on('click', function (e) {
            e.preventDefault();

            var answerId = $('input[name=r1]:checked').attr('id');
            var pollId = $('#getpollid').text();

            $.ajax({
                type: 'post',
                url: '@Url.Action("SetVote","Home")',
                data: { answerId: answerId, pollId: pollId },
                success: function (msg) {
                    if (msg.status == 'success') {
                        Swal.fire({
                            type: "success",
                            html: "<span class='text-dark ' style:'font-weight: bold'>نظر شما باموفقیت ثبت شد</span>",
                            animation: false,
                            confirmButtonColor: '#28a745',
                            confirmButtonText: 'تایید',
                        }).then(function () {
                            $('#poll').remove();
                            $("#poll-res").removeClass("d-none");
                            ///---------flot نمایش نتایج نطظر سنجی به صورت نمودار*-------------------

                            ///---------- دریافت نتایج نظر سنجی که به  فرمت جیسان است و تبدیل ان ارایه  ------------
                            var data = msg.getListOfAnswer;
                            ///--------تبدیل آرایه ریافتی از کنترلر به نوعع آبجکت -------------
                            var dataObject = $.parseJSON(data);
                            ///  flot تنظیمات پلاگین نمایش نمودار
                            var options = {
                                series: {
                                    pie: { show: true }
                                },
                                legend: {
                                    show: false
                                }
                            };
                            ///------- قبول میکند data فقط نوع آبجکت برای  -----------
                            $.plot($("#pie-chart"), dataObject, options);
                        })
                            };
                }
            }).done(function (msg) {
                if (msg.status == 'fail') {
                    Swal.fire({
                        type: "warning",
                        html: "<span class='text-dark ' style:'font-weight: bold'>لطفا برای شرکت در نظرسنجی یکی از گزینه ها را انتخاب نمایید</span>"
                        ,
                        animation: false,
                        confirmButtonColor: 'rgb(236, 155, 84)',
                        confirmButtonText: 'تایید',
                    });

                } else if (msg.status==="duplicate") {
                        Swal.fire({
                        type: "warning",
                        html: "<span class='text-dark ' style:'font-weight: bold'>شما قبلا در این نظر سنجی شرکت کرده اید</span>"
                        ,
                        animation: false,
                        confirmButtonColor: 'rgb(236, 155, 84)',
                        confirmButtonText: 'تایید',
                    });
                }
            });
        });
    </script>

    @* chart*@
    @*flot نمایش نتایج نطظر سنجی به صورت نمودار*@
    <script>

        ///---------- دریافت نتایج نظر سنجی که به  فرمت جیسان است و تبدیل ان ارایه  ------------
        var data = $('#getListOfAnswer').text();

        ///--------تبدیل آرایه ریافتی از کنترلر به نوعع آبجکت -------------
        //var dataObject = JSON.stringify(data);
        //var dataObject = $.parseJSON(data);
        var dataObject = JSON.parse(data);

        //var dataObject = [
        //    { label: "Pause", data: 150 },
        //    { label: "No Pause", data: 100 },
        //    { label: "Sleeping", data: 250 }
        //];
        ///  flot تنظیمات پلاگین نمایش نمودار
        var options = {
            series: {
                pie: { show: true }
            },
            legend: {
                show: false
            }
        };

        ///------- قبول میکند data فقط نوع آبجکت برای  -----------
        $.plot($("#pie-chart"), dataObject, options);
        //var plot = $("#pie-chart").plot(dataObject, options).data("plot");
    </script>


    <script>
        $(".pieLabel>div").addClass("persianumber");
          ///---------  نمایش اعداد  تاریخ و .. به صورت فارسی ----
        $('.persianumber').persianumber();
    </script>


    @* نمایش تب ها *@
    <script>
        $('#myTabs a').click(function (e) {
            e.preventDefault()
            $(this).tab('show')
        });
    </script>


}
